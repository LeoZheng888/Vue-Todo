import{j as V,r as u,k as A,g as d,h as C,c as w,o as v,a as h,b as t,t as g,w as L,v as F,l as i,n as x,F as M,m as O,p as U,i as D}from"./index-B33ki9nX.js";import{S as _}from"./sweetalert2.esm.all-Do4KgkwR.js";const I={id:"todoListPage",class:"bg-half"},j=t("h1",null,[t("a",null,"ONLINE TODO LIST")],-1),E={class:"todo_sm"},P={class:"conatiner todoListPage vhContainer"},X={class:"todoList_Content"},q={class:"inputBox"},G=t("i",{class:"fa fa-plus"},null,-1),H=[G],J={key:0,class:"todoList_nolist"},K=t("div",{class:"d-flex justify-content-center align-items-center"},[t("p",{class:"text-center"},"目前尚無待辦事項"),t("div",{class:"todoList_nolist_image"})],-1),Q=[K],R={key:1,class:"todoList_list"},W={class:"todoList_tab"},Y={class:"todoList_items"},Z={class:"todoList_label"},tt=["onClick","onUpdate:modelValue"],et=["onClick"],st=t("i",{class:"fa fa-times"},null,-1),ot={class:"todoList_statistics"},m="https://todolist-api.hexschool.io",it={__name:"todoListView",setup(at){V();const l=u("all"),r=u(""),y=u("");A(async()=>{await $()});const a=u(""),n=u([]),T=()=>{_.fire({title:"登出成功",icon:"success",confirmButtonText:"關閉",timer:2e3,willClose:()=>{C.push({name:"home"})}})},$=async()=>{if(a.value=c("someCookieName"),a.value)try{const e=await d.get(`${m}/users/checkout`,{headers:{Authorization:a.value}});y.value=e.data.nickname,e.data.status==!0&&await p()}catch{_.fire({title:"登入失效",icon:"error",text:"請重新登入",confirmButtonText:"關閉",timer:2e3}).then(()=>{C.push({name:"home"})})}else _.fire({title:"登入失效",icon:"error",text:"請重新登入",timer:2e3}).then(()=>{C.push({name:"home"})})};function c(e){const o=`; ${document.cookie}`.split(`; ${e}=`);return o.length===2?o.pop().split(";").shift():null}const p=async()=>{a.value=c("someCookieName");const e=await d.get(`${m}/todos`,{headers:{Authorization:a.value}});n.value=e.data.data},N=w(()=>n.value.filter(e=>!e.status).length),B=async()=>{a.value=c("someCookieName");try{(await d.post(`${m}/todos`,{content:r.value},{headers:{Authorization:a.value}})).data.status==!0&&_.fire({title:"新增成功",icon:"success",confirmButtonText:"關閉",timer:2e3}),r.value="",await p()}catch{_.fire({title:"新增失敗",icon:"error",text:"請重新新增",confirmButtonText:"關閉",timer:2e3}),r.value=""}},b=w(()=>l.value=="true"?n.value.filter(e=>e.status):l.value=="false"?n.value.filter(e=>!e.status):n.value),f=e=>{l.value=e},S=async e=>{a.value=c("someCookieName");try{const s=await d.patch(`${m}/todos/${e}/toggle`,{},{headers:{Authorization:a.value}});await p()}catch(s){alert("失敗",s.response.data.message)}},z=async e=>{a.value=c("someCookieName");try{const s=await d.delete(`${m}/todos/${e}`,{headers:{Authorization:a.value}});await p()}catch(s){alert("失敗",s.response.data.message)}};return(e,s)=>(v(),h("div",I,[t("nav",null,[j,t("ul",null,[t("li",E,[t("a",null,[t("span",null,g(y.value)+"的代辦",1)])]),t("li",null,[t("a",{onClick:T},"登出")])])]),t("div",P,[t("div",X,[t("div",q,[L(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>r.value=o),type:"text",placeholder:"請輸入待辦事項"},null,512),[[F,r.value]]),t("a",{href:"#",onClick:i(B,["prevent"])},H)]),n.value.length==0?(v(),h("div",J,Q)):(v(),h("div",R,[t("ul",W,[t("li",null,[t("a",{href:"#",onClick:s[1]||(s[1]=i(o=>f("all"),["prevent"])),class:x({active:l.value=="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",class:x({active:l.value=="false"}),onClick:s[2]||(s[2]=i(o=>f("false"),["prevent"]))}," 待完成 ",2)]),t("li",null,[t("a",{href:"#",class:x({active:l.value=="true"}),onClick:s[3]||(s[3]=i(o=>f("true"),["prevent"]))}," 已完成 ",2)])]),t("div",Y,[(v(!0),h(M,null,O(b.value,o=>(v(),h("ul",{class:"todoList_item",key:e.index},[t("li",null,[t("label",Z,[L(t("input",{class:"todoList_input",type:"checkbox",onClick:i(k=>S(o.id),["prevent"]),"onUpdate:modelValue":k=>o.status=k},null,8,tt),[[U,o.status]]),t("span",null,g(o.content),1)]),t("a",{href:"#",onClick:i(k=>z(o.id),["prevent"])},[D(" X "),st],8,et)])]))),128)),t("div",ot,[t("p",null,g(N.value)+"個待完成事項",1)])])]))])])]))}};export{it as default};
